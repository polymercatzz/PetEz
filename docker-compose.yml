version: '3.8'

services:
  mysql-auth:
    image: mysql:8.0
    container_name: pet-ez-mysql-auth
    environment:
      MYSQL_DATABASE: auth_db
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "3306:3306"
    volumes:
      - mysql-auth-data:/var/lib/mysql
    networks:
      - pet-ez-network
    restart: always

  auth-service:
    build:
      context: ./Services/auth-service
      dockerfile: Dockerfile
    container_name: pet-ez-auth-service
    ports:
      - "3002:3002"
    environment:
      DATABASE_URL: mysql://root:root@mysql-auth:3306/auth_db
      JWT_SECRET: petez-super-secret-jwt-key-2024
    depends_on:
      - mysql-auth
    networks:
      - pet-ez-network
    restart: always

  booking-service:
    build:
      context: ./Services/booking-service
      dockerfile: Dockerfile
    container_name: pet-ez-booking-service
    ports:
      - "3006:3006"
    environment:
      DATABASE_URL: mysql://root:root@mysql-auth:3306/auth_db
      JWT_SECRET: petez-super-secret-jwt-key-2024
    depends_on:
      - mysql-auth
    networks:
      - pet-ez-network
    restart: always

  sitter-service:
    build:
      context: ./Services/sitter-service
      dockerfile: Dockerfile
    container_name: pet-ez-sitter-service
    ports:
      - "3004:3004"
    environment:
      DB_HOST: mysql-auth
      DB_NAME: auth_db
      DB_USER: root
      DB_PASSWORD: root
      JWT_SECRET: petez-super-secret-jwt-key-2024
      SESSION_SECRET: petez-super-secret-session-key-2024
    depends_on:
      - mysql-auth
    networks:
      - pet-ez-network
    restart: always

  payment-service:
    build:
      context: ./Services/payment-service
      dockerfile: Dockerfile
    container_name: pet-ez-payment-service
    ports:
      - "3007:3007"
    environment:
      DB_NAME: auth_db
      DB_USER: root
      DB_PASSWORD: root
      DB_HOST: mysql-auth
      JWT_SECRET: petez-super-secret-jwt-key-2024
    depends_on:
      - mysql-auth
    networks:
      - pet-ez-network
    restart: always

  frontend:
    build:
      context: ./Frontend
      dockerfile: Dockerfile
    container_name: pet-ez-frontend
    ports:
      - "3001:3001"
    environment:
      DATABASE_URL: mysql://root:root@mysql-auth:3306/auth_db
      JWT_SECRET: petez-super-secret-jwt-key-2024
    depends_on:
      - auth-service
      - booking-service
      - payment-service
    networks:
      - pet-ez-network
    restart: always

  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: pet-ez-nginx
    ports:
      - "80:80"
    depends_on:
      - auth-service
      - booking-service
      - sitter-service
      - payment-service
      - frontend
    networks:
      - pet-ez-network

volumes:
  mysql-auth-data:

networks:
  pet-ez-network:
    driver: bridge